# テスト
## Sさん

### 事前注意
- 録画してください。カーソルが見えると嬉しい
- できれば音声も
- 困ったらすぐに教えて
- 良いと思ったらすぐに教えて
- 要望があったらすぐに教えて

### ミッション
- 新規登録
- アルバムの作成
- 「もんぶらん」という人のアルバムに写真を追加

### 実際にやってみる
- 新規登録後、何の表示もなくタイムラインへ飛ばされ、しばらくしたら元に戻った
    - 何かしらの案内が必要
- メールアドレスが違うときにログインを押すと、「パスワード管理」というのが開く。環境依存かも
- 写真の追加は + ボタンを押したくなっちゃってる
    - コメントを入力して送信しても即時反映されない。
- プロフィールのコメントエリアで、何に対するコメントかがわからない
- アルバムカードに + マークがあれば、追加がわかりやすい
- フレンド申請が承認されましたの通知がない
- アルバム詳細でドラッグアンドドロップで画像を投稿できたい
- 4K 画像の場合は勝手に縮小して投稿する
- 誰かのアルバムに画像を追加しようとすると NO_PERMISSION になる
- リアクションの UI で、ジャンルなのか、押せるリアクションなのかがわからない
- プロフィールの設定方法がわからない
    - アイコンの変更方法はわかりそう
    - 自己紹介の項目の変更できることがわかるために、鉛筆マークでも添える
- アルバムの URL は何を入れるべきものかがわからない。
- 4K 対応
- 通知を確認しても、１のマークが消えない
- フォローしている人の李ポストがフレンド・ウォッチじゃないと見えない
- 知らない人がアルバムに追加すると、タイムラインに浮上する
- コメントがついたらタイムラインのトップに浮上させるか
- タイムラインの上にフィルター機能を付ける
- タグ機能
    - 検索
    - タイムラインのフィルタリングで、ユーザーについているタグでフィルタリングしたい
- タイムラインとかにフッターが見えている
- アイコンにホバーしたときに注釈が表示されるように
- 「＋」「吹き出し」にホバーしたときに注釈が出ない
- ダークモードで画像追加モーダルが白い
- Unable todetect みたいなエラー。自分のアルバムに画像を追加したとき。追加できない
- 検索性
- プロフィールそのものの共有ボタンがあってもいいかも
- プロフィールページで投稿画像の数がクリックしないと反映されない

## 今後

### 不具合修正

#### 優先度・実装方針
- テスト駆動開発：最初にテストを作成・編集してから機能実装。既存テストも修正。
- 優先順位：不具合修正 → 改善 → 新機能
- テスト仕様定義：design/test/frontend/ と design/test/backend/ 配下に仕様を定義。既存同列ファイルを参照。
- テスト実装：test/ フォルダ配下の分類ごとにディレクトリを活用。

#### 登録
- 新規登録後、何の表示もなくタイムラインへ飛ばされ、しばらくしたら元に戻る
  - → 新規登録ボタン押下後、「メールを確認してください」モーダルを必ず表示（メールアドレス登録時）。モーダルの「確認」ボタン・エリア外クリック・×ボタンで閉じた場合、ルートディレクトリへ遷移。
  - メール認証メール送信：登録ボタン直後にメール送信。ローディング表示は不要。

#### タイムライン
- コメント送信後、即時反映されない
  - → 更新ボタン不要で自分の画面に即時反映。スクロール位置は維持。
  - 複数ユーザーの同時コメント送信時は、他ユーザーのコメントはリアルタイム反映しない（自分の画面のみ即時反映）。

#### 通知
- フレンド申請が承認された通知がない
  - → サイドナビバーの通知アイコンのバッジを+1し、承認通知を表示。
- 通知を確認してもバッジが消えない
  - → 通知画面を開いた時点でバッジを0（非表示）に。

#### アルバム詳細
- 他人のアルバムに画像追加でNO_PERMISSION、自分のアルバムでUnable to detect等のエラー
  - → firestore.rules等も調査し、原因特定・修正。
  - 再現手順は不明のため、Firestore.rulesと現行スクリプトを参考に調査してから対応。
- フレンド/ウォッチ対象のユーザーがリポストしたアルバムが、アルバムオーナーとフレンド/ウォッチでないと表示されない
  - → リポストは常に表示（ただしブロック・ミュート対象は除外）。
  - firestore.rulesの権限チェックロジックを確認・修正。

#### 設定
- ダークモードで画像追加モーダルが白い
  - → 既存CSSで適切な背景色を適用。全モーダルも確認。

#### プロフィール
- 投稿画像数がクリックしないと反映されない
  - → 画面表示直後に自動反映。

---

### 改善

#### タイムライン
- 写真追加時にアクセントカラーの「＋」ボタンを配置し、クリックでアルバム詳細画面へ遷移。
- コメントがついたらタイムラインのトップに浮上させる。
- 「タイムライン」見出し上部にフィルター機能（アルバムタグ・ユーザータグでフィルタリング。タグは新規作成も可能）。
  - UI：入力式。入力してエンターを押すと、タグとして表示。再度クリックで編集可。Postしたタイミングでサーバーに登録。
  - 複数タグフィルタリング：スペース区切りで複数タグを入力。AND条件でアルバム/ユーザーを絞り込み。
  - 入力時に候補タグを表示。重複保存防止。
  - スコープ：ログインユーザーのみ適用。（非ログイン時はタイムライン表示できない仕様）
  - フィルター状態の保持：ページリロード後もlocalStorageを使用してフィルター状態を保持。

#### プロフィール
- コメントタブで、どのアルバムへのコメントか分かるように。
- 設定方法が分かるよう鉛筆マークボタンを設置。
  - 配置：プロフィール欄の右上。アイコンホバー時に鉛筆マークが表示。
  - 鉛筆マークは共通コンポーネント化（新規作成）。コンポーネント名: EditPencilIcon。
  - props・className は実装者の判断で最適な設計。Button のように動作。
- プロフィール共有ボタンを作成。
- 「いいね」タブを作成し、いいねしたアルバムをアルバムカードで一覧（タイムライン形式）。
  - ※「いいね」タブは自分のみ閲覧可。既存タブUIと統一。

#### アルバム投稿
- 4K画像はクライアント側で縮小・Webp変換し、サーバーには縮小済みWebpのみ保存。
  - 最大解像度：1920x1080。アスペクト比を維持。
  - 対応形式：PNG/JPG/GIF（firestore.rulesを参照）。変換後はWebp形式。
  - 実装方法：Canvas APIまたはライブラリ（sharp等）を使用可。
  - 変換中のローディング表示：画像投稿モーダルに表示された画像サムネイルごとにローディングバーを表示。
  - 圧縮警告：画像選択後、モーダルに画像サムネが表示された段階で、圧縮が必要なファイルには「⚠️容量が大きいため、圧縮されます」と小さく重ねて表示。
- アルバムURL欄には「ワールドURLやBOOTHのリンクなど」プレースホルダーを表示。

#### アルバムカード
- リアクションUIでジャンル/押せるリアクションの区別を明確に。
- 写真追加マーク（＋等）を分かりやすく配置。

#### アルバム詳細
- オーナーはタイトル編集可。
- URL左に地球儀（🌐）アイコンを表示し、クリックでURL先へ遷移。

#### 通知
- 同一アルバム・同一内容の通知はまとめて表示。ユーザーアイコンを羅列。
  - 時間範囲の制限は不要（すべての通知が対象）。

#### その他
- タイムライン等にフッターが見えている→修正。
- すべてのボタンにホバー注釈を表示（＋や吹き出し等も含む）。

#### パスワード修正
- サイドナビバーの歯車アイコンから、「パスワードの変更」リンクを作成し、パスワード変更画面へとリンクするようにしてください。パスワード変更画面を新しく作成してください。現在のパスワードを入力し、新しいパスワード、新しいパスワード(確認)を入力し、パスワードを更新できるようにしてください。
---

### タグ機能追加実装

#### プロフィール
- 自身にユーザータグを5つまで付与可。タグ名は10字以内、日本語＋英数字＋アンダーバーのみ、空白禁止。同じタグ名でも登録可。
- タグはプロフィールアイコン下に横並びで表示。
- 一度付けたタグは削除・編集可。
- タグ入力UI：入力式。エンターでタグ化、再クリックで編集可。
- Firestoreスキーマ変更について、既存データへの影響は考慮不要。

#### アルバム作成/詳細
- タグ入力欄を追加。オーナーのみ設定可。最大5つまで。タグ編集も可。
- タグはオプショナル（必須ではない）。

---

### 検索機能強化
- 入力欄にキーワードを入力すると、4カテゴリの結果を同時表示：
  - ユーザータグ（横並び）
  - アルバムタグ（横並び）
  - ユーザー（横並び）
  - アルバム（タイムライン同様の縦並び、無限スクロール、アルバムカードコンポーネント）
- タグをクリックすると、そのタグで再検索状態に。
- ユーザークリックでプロフィール画面、アルバムクリックでアルバム詳細画面へ遷移。
- 既存の検索ページを拡張する形で実装。

---

### パスワード変更画面
- 新規ページ `/settings/password` を作成。
- 現在のパスワード、新しいパスワード、新しいパスワード（確認）を入力し、パスワードを更新。
- サイドナビの歯車メニューから「パスワードの変更」リンクを追加。

---

### URL修正
- privacy-policy と termsofservice と faq を /legal/ 配下に配置。関連リンクを修正
- reset-password と forgot-password を /settings/ 配下に配置。関連リンクを修正。


### 実装の優先順位

以下の3フェーズで実装を進めます：

#### フェーズ1（小規模な機能追加）
1. プロフィールに鉛筆マーク編集ボタンを追加
2. プロフィール共有ボタンを追加
3. パスワード変更画面の作成（`/settings/password`）
4. コメントタブでアルバム情報を表示

#### フェーズ2（中規模な機能追加）
5. プロフィールに「いいね」タブを追加
6. 4K画像の自動縮小・Webp変換（クライアント側）

#### フェーズ3（大規模な機能追加・DB変更を伴う）
7. タグ機能の実装（Firestoreスキーマ変更 + firestore.rules更新）
8. フィルター機能の実装（タグ機能に依存）
9. 検索機能の強化（タグ機能に依存）
10. 通知のまとめ表示

---
### 対応しない（仕様）
- メールアドレスが違うときにログインを押すと、「パスワード管理」というのが開く（環境依存のため対応しない）
- 知らない人がアルバムに画像を追加すると、タイムラインに浮上する（仕様）
